<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Wordle - with Reset</title>
    <style>
        :root {
            --bg-color: #121213;
            --tile-border: #3a3a3c;
            --correct: #538d4e;
            --present: #b59f3b;
            --absent: #3a3a3c;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: var(--bg-color);
            color: white;
            margin: 0;
            padding: 20px;
        }

        #status-badge {
            font-size: 0.8rem;
            padding: 5px 15px;
            border-radius: 20px;
            margin-bottom: 15px;
            font-weight: bold;
        }
        .status-loading { background: #b59f3b; color: black; }
        .status-success { background: #538d4e; color: white; }
        .status-error { background: #ff4444; color: white; }

        #game-board {
            display: grid;
            grid-template-columns: repeat(5, 60px);
            grid-template-rows: repeat(6, 60px);
            gap: 5px;
            margin-bottom: 20px;
        }

        .tile {
            width: 60px;
            height: 60px;
            border: 2px solid var(--tile-border);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            font-weight: bold;
            text-transform: uppercase;
            box-sizing: border-box;
            transition: transform 0.1s;
        }

        .correct { background-color: var(--correct); border-color: var(--correct); }
        .present { background-color: var(--present); border-color: var(--present); }
        .absent  { background-color: var(--absent); border-color: var(--absent); }

        #input-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .controls {
            display: flex;
            gap: 10px;
        }

        input {
            padding: 10px;
            font-size: 1.2rem;
            text-transform: uppercase;
            background: var(--bg-color);
            color: white;
            border: 1px solid #565758;
            width: 140px;
            text-align: center;
            border-radius: 4px;
        }

        button {
            padding: 10px 15px;
            font-size: 1rem;
            background-color: #818384;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            border-radius: 4px;
        }

        button:hover { opacity: 0.8; }
        button:disabled { opacity: 0.3; cursor: not-allowed; }

        /* ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #reset-btn {
            background-color: #1a73e8;
        }

        #message {
            margin-top: 20px;
            font-weight: bold;
            min-height: 1.5em;
            text-align: center;
            color: #d7dadc;
        }
    </style>
</head>
<body>

    <h1>WORDLE</h1>
    
    <div id="status-badge" class="status-loading">Dictionary: Loading...</div>
    
    <div id="game-board"></div>

    <div id="input-area">
        <div class="controls">
            <input type="text" id="guess-input" maxlength="5" placeholder="5æ–‡å­—" disabled>
            <button id="guess-btn" onclick="handleGuess()" disabled>åˆ¤å®š</button>
            <button id="reset-btn" onclick="resetGame()" style="display: none;">æ–°ã—ãå§‹ã‚ã‚‹</button>
        </div>
    </div>
    
    <p id="message">è¾æ›¸ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ã¾ã™...</p>

    <script>
        const DICTIONARY_URL = "https://cdn.jsdelivr.net/gh/tabatkins/wordle-list@main/words";
        
        let wordList = [];
        let secretWord = "";
        let currentRow = 0;

        const inputEl = document.getElementById("guess-input");
        const btnEl = document.getElementById("guess-btn");
        const resetBtnEl = document.getElementById("reset-btn");
        const msgEl = document.getElementById("message");
        const statusEl = document.getElementById("status-badge");

        // 1. åˆæœŸåŒ–ï¼šè¾æ›¸ã‚’èª­ã¿è¾¼ã‚€
        async function initGame() {
            try {
                const response = await fetch(DICTIONARY_URL);
                if (!response.ok) throw new Error("Fetch Failed");
                
                const text = await response.text();
                wordList = text.split(/\s+/)
                               .map(w => w.trim().toUpperCase())
                               .filter(w => w.length === 5);

                statusEl.textContent = `Dictionary: Loaded (${wordList.length} words)`;
                statusEl.className = "status-success";
                
                inputEl.disabled = false;
                btnEl.disabled = false;
                resetBtnEl.style.display = "inline-block"; // èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«è¡¨ç¤º
                
                startGame();
            } catch (error) {
                console.error(error);
                statusEl.textContent = "Dictionary: Load Error";
                statusEl.className = "status-error";
                msgEl.textContent = "è¾æ›¸ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
            }
        }

        // 2. ã‚²ãƒ¼ãƒ é–‹å§‹è¨­å®š
        function startGame() {
            currentRow = 0;
            secretWord = wordList[Math.floor(Math.random() * wordList.length)];
            console.log("Secret (Debug):", secretWord); 
            
            msgEl.textContent = "5æ–‡å­—ã®è‹±å˜èªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„";
            msgEl.style.color = "#d7dadc";
            inputEl.value = "";
            inputEl.disabled = false;
            btnEl.disabled = false;
            
            createBoard();
            inputEl.focus();
        }

        // 3. ãƒªã‚»ãƒƒãƒˆå‡¦ç†
        function resetGame() {
            if (confirm("ä»Šã®ã‚²ãƒ¼ãƒ ã‚’ä¸­æ–­ã—ã¦ã€æ–°ã—ã„å˜èªã§å§‹ã‚ã¾ã™ã‹ï¼Ÿ")) {
                startGame();
            }
        }

        function createBoard() {
            const board = document.getElementById("game-board");
            board.innerHTML = "";
            for (let i = 0; i < 30; i++) {
                let tile = document.createElement("div");
                tile.className = "tile";
                tile.id = "tile-" + i;
                board.appendChild(tile);
            }
        }

        function handleGuess() {
            const guess = inputEl.value.toUpperCase();

            if (guess.length !== 5) return;
            if (!wordList.includes(guess)) {
                msgEl.textContent = `ã€Œ${guess}ã€ã¯è¾æ›¸ã«ã‚ã‚Šã¾ã›ã‚“`;
                return;
            }

            // åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
            let colors = Array(5).fill("absent");
            let secretChars = secretWord.split("");
            let guessChars = guess.split("");
            
            for (let i = 0; i < 5; i++) {
                if (guessChars[i] === secretChars[i]) {
                    colors[i] = "correct";
                    secretChars[i] = null;
                    guessChars[i] = null;
                }
            }

            for (let i = 0; i < 5; i++) {
                if (guessChars[i] !== null) {
                    let foundIndex = secretChars.indexOf(guessChars[i]);
                    if (foundIndex !== -1) {
                        colors[i] = "present";
                        secretChars[foundIndex] = null;
                    }
                }
            }

            updateUI(guess, colors);

            if (guess === secretWord) {
                msgEl.textContent = "ğŸ‰ ãŠã‚ã§ã¨ã†ï¼æ­£è§£ã§ã™ï¼";
                msgEl.style.color = "#538d4e";
                inputEl.disabled = true;
                btnEl.disabled = true;
            } else {
                currentRow++;
                if (currentRow >= 6) {
                    msgEl.textContent = `æ®‹å¿µï¼æ­£è§£ã¯ ${secretWord} ã§ã—ãŸã€‚`;
                    inputEl.disabled = true;
                    btnEl.disabled = true;
                } else {
                    msgEl.textContent = "";
                    inputEl.value = "";
                    inputEl.focus();
                }
            }
        }

        function updateUI(guess, colors) {
            const startIdx = currentRow * 5;
            for (let i = 0; i < 5; i++) {
                const tile = document.getElementById("tile-" + (startIdx + i));
                tile.textContent = guess[i];
                tile.className = "tile " + colors[i];
            }
        }

        inputEl.addEventListener("keypress", (e) => {
            if (e.key === "Enter") handleGuess();
        });

        initGame();
    </script>
</body>
</html>
