<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Wordle - Custom Logic</title>
    <style>
        /* CSS æ¬„ */
        :root {
            --bg-color: #121213;
            --tile-border: #3a3a3c;
            --correct: #538d4e; /* ç·‘ */
            --present: #b59f3b; /* é»„ */
            --absent: #3a3a3c;  /* ç° */
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: var(--bg-color);
            color: white;
            margin: 0;
            padding: 20px;
        }

        #status-badge {
            font-size: 0.8rem;
            padding: 5px 15px;
            border-radius: 20px;
            margin-bottom: 15px;
            font-weight: bold;
            transition: all 0.3s;
        }
        .status-loading { background: #b59f3b; color: black; }
        .status-success { background: #538d4e; color: white; }
        .status-error { background: #ff4444; color: white; }

        #game-board {
            display: grid;
            grid-template-columns: repeat(5, 60px);
            grid-template-rows: repeat(6, 60px);
            gap: 5px;
            margin-bottom: 20px;
        }

        .tile {
            width: 60px;
            height: 60px;
            border: 2px solid var(--tile-border);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            font-weight: bold;
            text-transform: uppercase;
            box-sizing: border-box;
        }

        /* åˆ¤å®šçµæœã®ã‚¯ãƒ©ã‚¹ */
        .correct { background-color: var(--correct); border-color: var(--correct); }
        .present { background-color: var(--present); border-color: var(--present); }
        .absent  { background-color: var(--absent); border-color: var(--absent); }

        #input-area {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        input {
            padding: 10px;
            font-size: 1.2rem;
            text-transform: uppercase;
            background: var(--bg-color);
            color: white;
            border: 1px solid #565758;
            width: 140px;
            text-align: center;
            border-radius: 4px;
        }

        button {
            padding: 10px 20px;
            font-size: 1.1rem;
            background-color: #818384;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            border-radius: 4px;
        }

        button:disabled { opacity: 0.5; cursor: not-allowed; }

        #message {
            margin-top: 20px;
            font-weight: bold;
            min-height: 1.5em;
            text-align: center;
            color: #d7dadc;
        }
    </style>
</head>
<body>

    <h1>WORDLE</h1>
    
    <div id="status-badge" class="status-loading">Dictionary: Loading...</div>
    
    <div id="game-board"></div>

    <div id="input-area">
        <input type="text" id="guess-input" maxlength="5" placeholder="5æ–‡å­—" disabled>
        <button id="guess-btn" onclick="handleGuess()" disabled>åˆ¤å®š</button>
    </div>
    
    <p id="message">è¾æ›¸ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ã¾ã™...</p>

    <script>
        // --- JavaScript æ¬„ ---
        
        // å¤–éƒ¨è¾æ›¸ã®URL (jsDelivrçµŒç”±ã§ç¢ºå®Ÿã«å–å¾—)
        const DICTIONARY_URL = "https://cdn.jsdelivr.net/gh/tabatkins/wordle-list@main/words-guesses.txt";
        
        let wordList = [];
        let secretWord = "";
        let currentRow = 0;

        const inputEl = document.getElementById("guess-input");
        const btnEl = document.getElementById("guess-btn");
        const msgEl = document.getElementById("message");
        const statusEl = document.getElementById("status-badge");

        // 1. èµ·å‹•æ™‚ã«è¾æ›¸ã‚’èª­ã¿è¾¼ã‚€
        async function initGame() {
            try {
                const response = await fetch(DICTIONARY_URL);
                if (!response.ok) throw new Error("Fetch Failed");
                
                const text = await response.text();
                // ç©ºç™½æ–‡å­—ã§åŒºåˆ‡ã£ã¦5æ–‡å­—ã®å˜èªã‚’æŠ½å‡º
                wordList = text.split(/\s+/)
                               .map(w => w.trim().toUpperCase())
                               .filter(w => w.length === 5);

                if (wordList.length < 1000) throw new Error("Invalid Dictionary");

                // èª­ã¿è¾¼ã¿æˆåŠŸæ™‚ã®è¨­å®š
                statusEl.textContent = `Dictionary: Loaded (${wordList.length} words)`;
                statusEl.className = "status-success";
                msgEl.textContent = "5æ–‡å­—ã®è‹±å˜èªã‚’å…¥åŠ›ã—ã¦åˆ¤å®šãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„";
                
                // å…¥åŠ›ãƒ­ãƒƒã‚¯è§£é™¤
                inputEl.disabled = false;
                btnEl.disabled = false;
                
                startGame();
            } catch (error) {
                console.error(error);
                statusEl.textContent = "Dictionary: Load Error";
                statusEl.className = "status-error";
                msgEl.textContent = "è¾æ›¸ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã—ã¦ãã ã•ã„ã€‚";
            }
        }

        function startGame() {
            // ãƒªã‚¹ãƒˆã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«æ­£è§£ã‚’é¸ã¶
            secretWord = wordList[Math.floor(Math.random() * wordList.length)];
            console.log("Secret (Debug):", secretWord); // é–‹ç™ºç”¨
            
            createBoard();
            inputEl.focus();
        }

        function createBoard() {
            const board = document.getElementById("game-board");
            board.innerHTML = "";
            for (let i = 0; i < 30; i++) {
                let tile = document.createElement("div");
                tile.className = "tile";
                tile.id = "tile-" + i;
                board.appendChild(tile);
            }
        }

        // 2. åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ (æŒ‡å®šï¼šé»„è‰²ã‚’ä¸€é€šã‚Šå¡—ã£ã¦ã‹ã‚‰ç·‘ã§ä¸Šæ›¸ã)
        function handleGuess() {
            const guess = inputEl.value.toUpperCase();

            // åŸºæœ¬ãƒã‚§ãƒƒã‚¯
            if (guess.length !== 5) return;
            if (!wordList.includes(guess)) {
                msgEl.textContent = `ã€Œ${guess}ã€ã¯è¾æ›¸ã«ã‚ã‚Šã¾ã›ã‚“`;
                return;
            }

            // --- åˆ¤å®šã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ é–‹å§‹ ---
            
            // A. æ­£è§£å˜èªã®å„æ–‡å­—ã®å‡ºç¾å›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
            let secretCounts = {};
            for (let char of secretWord) {
                secretCounts[char] = (secretCounts[char] || 0) + 1;
            }

            let colors = Array(5).fill("absent"); // åŸºæœ¬ã¯ç°è‰²
            let guessArr = guess.split("");

            // B. [ä¸€æ—¦å…¥ã£ã¦ã„ã‚‹ã‚‚ã®ã‚’å…ˆé ­ã‹ã‚‰å€‹æ•°åˆ†é»„è‰²ã«ã™ã‚‹]
            for (let i = 0; i < 5; i++) {
                let char = guessArr[i];
                if (secretCounts[char] > 0) {
                    colors[i] = "present"; // é»„è‰²åˆ¤å®š
                    secretCounts[char]--;
                }
            }

            // C. [ãã®å¾Œã€ä½ç½®ãŒã‚ã£ã¦ã„ã‚‹ã‚‚ã®ã®ã¿ç·‘ã«å¤‰æ›´]
            for (let i = 0; i < 5; i++) {
                if (guessArr[i] === secretWord[i]) {
                    colors[i] = "correct"; // ç·‘ï¼ˆé»„è‰²ã‚’ä¸Šæ›¸ãï¼‰
                }
            }
            // --- åˆ¤å®šã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ çµ‚äº† ---

            updateUI(guess, colors);

            // å‹æ•—åˆ¤å®š
            if (guess === secretWord) {
                msgEl.textContent = "ğŸ‰ ãŠã‚ã§ã¨ã†ï¼æ­£è§£ã§ã™ï¼";
                msgEl.style.color = "#538d4e";
                inputEl.disabled = true;
                btnEl.disabled = true;
            } else {
                currentRow++;
                if (currentRow >= 6) {
                    msgEl.textContent = `æ®‹å¿µï¼æ­£è§£ã¯ ${secretWord} ã§ã—ãŸã€‚`;
                    inputEl.disabled = true;
                    btnEl.disabled = true;
                } else {
                    msgEl.textContent = "";
                    inputEl.value = "";
                    inputEl.focus();
                }
            }
        }

        function updateUI(guess, colors) {
            const startIdx = currentRow * 5;
            for (let i = 0; i < 5; i++) {
                const tile = document.getElementById("tile-" + (startIdx + i));
                tile.textContent = guess[i];
                tile.className = "tile " + colors[i];
            }
        }

        // Enterã‚­ãƒ¼ã§åˆ¤å®š
        inputEl.addEventListener("keypress", (e) => {
            if (e.key === "Enter") handleGuess();
        });

        // åˆæœŸåŒ–
        initGame();
    </script>
</body>
</html>
